#include "states.h"
#include "scanner.h"
#include "ErrorHandling.h"

int StatesMatrix[NUM_STATES][NUM_ALPHABET] =
{
    //s0: b,g,j,k,p,q,x,y,z
    //s1: (, ), {, }, [, ], ,, ;
    //s2: =, >, +, *
    // a,  c,  d, e,  f,  h,  i,  l, m,  n,  o,  r,  s,  t,  u,  v, w, s0, 09, AZ, s1, s2, s3, ""  
    { 25, 15, 25, 5, 25, 25, 12, 25, 8, 25, 25, 21, 25, 25, 25, 18, 1, 25, 29, 25, 30, 31, 28, 26 },
    { -1, -1, -1, -1, -1, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    {  9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, 11, -1, -1, -1, -1, 13, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, 16, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 19, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, 20, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, 22, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 23, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 24, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, -1, -1, -1, -1 },
    { 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, -1, -1, -1, 27 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 29, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
    { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
};

int charToColumn(char c)
{
    if(c == 'a')
    {
        return 0;
    }
    else if (c == 'c')
    {
        return 1;
    }
    else if(c == 'd')
    {
        return 2;
    }
    else if(c == 'e')
    {
        return 3;
    }
    else if(c == 'f')
    {
        return 4;
    }
    else if(c == 'h')
    {
        return 5;
    }
    else if(c == 'i')
    {
        return 6;
    }
    else if(c == 'l')
    {
        return 7;
    }
    else if(c == 'm')
    {
        return 8;
    }
    else if(c == 'n')
    {
        return 9;
    }
    else if(c == 'o')
    {
        return 10;
    }
    else if(c == 'r')
    {
        return 11;
    }
    else if(c == 's')
    {
        return 12;
    }
    else if(c == 't')
    {
        return 13;
    }
    else if(c == 'u')
    {
        return 14;
    }
    else if(c == 'v')
    {
        return 15;
    }
    else if(c == 'w')
    {
        return 16;
    }
    // s0 = b, g, j, k, p, q, x, y, z
    else if(c == 'b' || c == 'g' || c == 'j' || c == 'k' || c == 'p' || c == 'q' || c == 'x' || c == 'y' || c == 'z')
    {
        return 17;
    }
    // 0 - 9
    else if(c == '0' || c == '1' || c == '2' || c == '3' || c == '4' || c == '5' || c == '6' || c == '7' || c == '8' || c == '9')
    {
        return 18;
    }
    // A - Z
    else if(c >= 65 && c <= 90)
    {
        return 19;
    }
    // s1: (, ), {, }, [, ], ,, ;
    else if(c == '(' || c == ')' || c == '{' || c == '}' || c == '[' || c == ']' || c == ',' || c == ';')
    {
        return 20; 
    }
    // s2: =, >, +, *
    else if(c == '=' || c == '>' || c == '+' || c == '*')
    {
        return 21;
    }
    // S3: space, \n, \t
    else if(c == ' ' || c == '\n' || c == '\t')
    {
        return 22;
    }
    else if(c == '"')
    {
        return 23;
    }
    return INVALID_CHAR; // invalid column
}

int isFinalState(int state)
{
    if(state == CAT_TYPES || state == CAT_KEYWORD || state == CAT_IDENTIFIER || state == CAT_LITERAL || state == CAT_NONESSENTIAL || state == CAT_NUMBER || state == CAT_SPECIALCHAR || state == CAT_OPERAND)
    {
        return 1;
    }
    else
    {
        return 0;
    }
}

char* finalStateToString(int state)
{
    switch(state)
    {
        case CAT_TYPES:
            return "CAT_TYPES";
        case CAT_KEYWORD:
            return "CAT_KEYWORD";
        case CAT_IDENTIFIER:
            return "CAT_IDENTIFIER";
        case CAT_LITERAL:
            return "CAT_LITERAL";
        case CAT_NONESSENTIAL:
            return "CAT_NONESSENTIAL";
        case CAT_NUMBER:
            return "CAT_NUMBER";
        case CAT_SPECIALCHAR:
            return "CAT_SPECIALCHAR";
        case CAT_OPERAND:
            return "CAT_OPERAND";
        default:
            return "INVALID_STATE";
    }
}

int notifySintaxErrorIfAny(int column, char c, FILE* outputFile)
{
    if (column == INVALID_CHAR)
    {
        handleError(3, 2, &c);
        return 1; // erroR
    }
    else
    {
        return 0; // no error
    }
}